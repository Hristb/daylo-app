import{j as e,m as i,A as P}from"./animation-CGUQWomD.js";import{r as d}from"./react-vendor-DRMccTfR.js";import{a as $,A as q,u as J,g as B,b as V,L as G}from"./index-yaOworqU.js";import{s as M,m as O,l as K,S as k,p as Q,q as W,A as X,H as Y,L as Z}from"./icons-DbjOiOOr.js";import"./firebase-C-zsfMAV.js";function _(){const[c,r]=d.useState([]),[l,t]=d.useState(!0);d.useEffect(()=>{x()},[]);const x=async()=>{t(!0);try{const o=(await $(7)).slice(0,5);r(o),console.log("âœ… Ãšltimas 5 actividades desde Firebase")}catch(s){console.error("Error cargando historial:",s);const o=JSON.parse(localStorage.getItem("daylo-activity-history")||"[]");r(o.slice(0,5))}finally{t(!1)}},N=s=>{const o=new Date(s),p=new Date().toISOString().split("T")[0],y=new Date(Date.now()-864e5).toISOString().split("T")[0];return s===p?"Hoy":s===y?"Ayer":o.toLocaleDateString("es-ES",{day:"numeric",month:"short"})};return e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl border-2 border-green-200 shadow-sm mb-6",children:[e.jsx("div",{className:"px-6 py-4 border-b border-green-100 bg-gradient-to-r from-green-50 to-teal-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-400 to-teal-400 rounded-xl flex items-center justify-center",children:e.jsx(M,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"Actividad Reciente"}),e.jsx("p",{className:"text-xs text-green-600",children:"Ãšltimas 5 actividades registradas"})]})]})}),e.jsx("div",{className:"p-6",children:l?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(i.div,{className:"w-10 h-10 mx-auto border-4 border-green-200 border-t-green-500 rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}),e.jsx("p",{className:"text-sm text-gray-500 mt-3",children:"Cargando..."})]}):c.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No hay actividades registradas aÃºn"}),e.jsx("p",{className:"text-xs mt-1",children:"Tus primeras actividades aparecerÃ¡n aquÃ­"})]}):e.jsx("div",{className:"space-y-3",children:c.map((s,o)=>e.jsxs(i.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:o*.1},className:"flex items-center gap-3 p-3 bg-gradient-to-r from-green-50 to-teal-50 rounded-xl border border-green-200 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(q,{type:s.activityIcon,size:28})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-800 text-sm truncate",children:s.activityLabel}),e.jsxs("span",{className:"text-sm font-bold text-green-600 flex-shrink-0 ml-2",children:[Math.floor(s.duration/60),"h ",s.duration%60,"m"]})]}),s.notes&&e.jsxs("p",{className:"text-xs text-gray-600 truncate mb-1",children:["ðŸ’­ ",s.notes]}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-gray-500",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{children:N(s.date)}),e.jsx("span",{children:"â€¢"}),e.jsx(K,{className:"w-3 h-3"}),e.jsx("span",{children:new Date(s.timestamp).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})})]})]})]},s.id))})})]})}function re(){const{resetStore:c}=J(),r=localStorage.getItem("daylo-user-name")||"Usuario",l=localStorage.getItem("daylo-user-email")||"",[t,x]=d.useState({totalDays:0,currentStreak:0,longestStreak:0,totalActivities:0,totalTasks:0,completedTasks:0,averageRating:0,favoriteActivity:""}),[N,s]=d.useState(!0),[o,p]=d.useState(!1);d.useEffect(()=>{y();const u=()=>{document.hidden||y()};return document.addEventListener("visibilitychange",u),()=>document.removeEventListener("visibilitychange",u)},[]);const y=async()=>{try{let g=JSON.parse(localStorage.getItem("daylo-entries")||"[]");try{const a=await B();a.length>0&&(g=a)}catch{console.log("âš ï¸ Firebase no disponible, usando datos locales")}if(g.length===0){s(!1);return}const z=g.length;let I=0,D=0,A=0,E=0,w=0;const h={};g.forEach(a=>{var n,m,C,R,H;I+=((n=a.activities)==null?void 0:n.length)||0,(m=a.activities)==null||m.forEach(f=>{h[f.label]=(h[f.label]||0)+1}),D+=((C=a.tasks)==null?void 0:C.length)||0,A+=((R=a.tasks)==null?void 0:R.filter(f=>f.completed).length)||0,(H=a.reflection)!=null&&H.dayRating&&(E+=a.reflection.dayRating,w++)});const F=Object.keys(h).reduce((a,n)=>h[a]>h[n]?a:n,""),T=g.sort((a,n)=>new Date(n.date).getTime()-new Date(a.date).getTime());let L=0,S=0,b=0;for(let a=0;a<T.length;a++){const n=new Date(T[a].date),m=new Date;m.setDate(m.getDate()-a),n.toDateString()===m.toDateString()?(b++,a===0&&(L=b),S=Math.max(S,b)):b=0}x({totalDays:z,currentStreak:L,longestStreak:S,totalActivities:I,totalTasks:D,completedTasks:A,averageRating:w>0?E/w:0,favoriteActivity:F})}catch(u){console.error("Error loading stats:",u)}finally{s(!1)}},U=()=>{sessionStorage.setItem("daylo-just-logged-out","true"),c(),localStorage.removeItem("daylo-user-name"),localStorage.removeItem("daylo-user-email"),localStorage.removeItem("daylo-entries"),localStorage.removeItem("daylo-last-checkin"),localStorage.removeItem("daylo-activity-history"),localStorage.removeItem("daylo-time-history"),localStorage.removeItem("daylo-onboarding-complete"),localStorage.removeItem("userName"),localStorage.removeItem("userEmail"),window.location.href=window.location.pathname,window.location.reload()};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 pb-20",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-purple-400 via-pink-400 to-blue-400 rounded-3xl p-8 mb-6 relative overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"absolute inset-0 opacity-20",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-white rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center",children:[e.jsxs(i.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:150,damping:12},className:"mb-4 relative group",children:[e.jsx(i.div,{className:"absolute inset-0 rounded-full",animate:{rotate:360,scale:[1,1.05,1]},transition:{rotate:{duration:20,repeat:1/0,ease:"linear"},scale:{duration:3,repeat:1/0,ease:"easeInOut"}},style:{background:"conic-gradient(from 0deg, rgba(255,255,255,0.4), transparent, rgba(255,255,255,0.4))",filter:"blur(2px)",transform:"scale(1.15)"}}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{name:r,email:l,size:140,className:"drop-shadow-2xl ring-4 ring-white/30"}),e.jsx(i.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.3,type:"spring"},className:"absolute -bottom-2 -right-2 bg-white rounded-full p-2 shadow-xl",title:"Tu identicon Ãºnico generado automÃ¡ticamente",children:e.jsx(k,{className:"w-5 h-5 text-purple-500"})})]})]}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2 drop-shadow-lg",children:r}),e.jsxs("div",{className:"flex items-center gap-2 text-white/90 mb-4",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:l})]}),e.jsxs(i.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.2},className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:"Usuario Daylo"})]})]})]}),N?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-purple-400 border-t-transparent rounded-full mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-4",children:"Cargando estadÃ­sticas..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(v,{icon:e.jsx(O,{className:"w-5 h-5"}),label:"DÃ­as registrados",value:t.totalDays,color:"from-purple-300 to-purple-400"}),e.jsx(v,{icon:e.jsx(W,{className:"w-5 h-5"}),label:"Racha actual",value:t.currentStreak,suffix:" dÃ­as",color:"from-pink-300 to-pink-400"}),e.jsx(v,{icon:e.jsx(X,{className:"w-5 h-5"}),label:"Mejor racha",value:t.longestStreak,suffix:" dÃ­as",color:"from-blue-300 to-blue-400"}),e.jsx(v,{icon:e.jsx(Y,{className:"w-5 h-5"}),label:"Promedio dÃ­a",value:t.averageRating.toFixed(1),suffix:"/5",color:"from-indigo-300 to-indigo-400"})]}),e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 mb-4",children:"ðŸ“Š Tu Actividad"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{label:"Actividades registradas",value:t.totalActivities}),e.jsx(j,{label:"Tareas creadas",value:t.totalTasks}),e.jsx(j,{label:"Tareas completadas",value:t.completedTasks,extra:t.totalTasks>0?`${Math.round(t.completedTasks/t.totalTasks*100)}% completitud`:""}),t.favoriteActivity&&e.jsx(j,{label:"Actividad favorita",value:t.favoriteActivity,isText:!0})]})]}),t.currentStreak>0&&e.jsxs(i.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.4},className:"bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl p-6 mb-6 border border-purple-200",children:[e.jsxs("h3",{className:"font-bold text-purple-800 mb-2 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Â¡Sigue asÃ­!"]}),e.jsxs("p",{className:"text-purple-700 text-sm",children:[t.currentStreak>=7&&"ðŸ”¥ Â¡IncreÃ­ble! Llevas una semana completa registrando tu vida.",t.currentStreak>=3&&t.currentStreak<7&&"â­ Â¡Excelente! EstÃ¡s construyendo un hÃ¡bito poderoso.",t.currentStreak<3&&"ðŸ’ª Â¡Buen comienzo! La constancia es la clave del autodescubrimiento."]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(_,{})}),e.jsxs(i.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},onClick:()=>p(!0),className:"w-full bg-white hover:bg-red-50 border border-red-200 text-red-600 font-semibold py-4 rounded-2xl flex items-center justify-center gap-2 transition-colors",children:[e.jsx(Z,{className:"w-5 h-5"}),"Cerrar SesiÃ³n"]})]}),e.jsx(P,{children:o&&e.jsx(G,{onConfirm:U,onCancel:()=>p(!1)})})]})}function v({icon:c,label:r,value:l,suffix:t="",color:x}){return e.jsxs(i.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},whileHover:{scale:1.05},className:`bg-gradient-to-br ${x} rounded-2xl p-4 text-white shadow-lg`,children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:c}),e.jsxs("div",{className:"text-2xl font-bold text-center mb-1",children:[l,t]}),e.jsx("div",{className:"text-xs text-center opacity-90",children:r})]})}function j({label:c,value:r,extra:l,isText:t=!1}){return e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"text-sm text-gray-600",children:c}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`${t?"text-sm":"text-lg"} font-bold text-gray-800`,children:r}),l&&e.jsx("span",{className:"text-xs text-gray-500 block",children:l})]})]})}export{re as default};
